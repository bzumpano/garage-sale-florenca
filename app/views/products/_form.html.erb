<%= form_with(model: product, local: true, html: { class: 'space-y-6 bg-white p-6 rounded shadow max-w-xl mx-auto' }) do |form| %>
  <% if product.errors.any? %>
    <div class="mb-4 p-4 rounded bg-red-100 text-red-800 border border-red-200">
      <h2 class="font-bold mb-2"><%= pluralize(product.errors.count, "erro") %> proibiu este produto de ser salvo:</h2>
      <ul class="list-disc pl-5">
        <% product.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :images, t('products.form.images'), class: 'block font-medium text-gray-700 mb-1' %>
    <%= form.file_field :images, multiple: true, direct_upload: true, accept: 'image/*', capture: 'environment', class: 'block w-full border border-gray-300 rounded px-3 py-2' %>
    <% if product.images.attached? %>
      <div class="flex flex-wrap gap-2 mt-2">
        <% product.images.each do |image| %>
          <%= image_tag image.variant(resize_to_limit: [100, 100]), class: 'rounded border' %>
        <% end %>
      </div>
    <% end %>
  </div>

  <div>
    <%= form.label :name, t('products.form.name'), class: 'block font-medium text-gray-700 mb-1' %>
    <%= form.text_field :name, class: 'block w-full border border-gray-300 rounded px-3 py-2', required: true %>
  </div>

  <div>
    <%= form.label :details, t('products.form.details'), class: 'block font-medium text-gray-700 mb-1' %>
    <%= form.rich_text_area :details, class: 'block w-full border border-gray-300 rounded px-3 py-2 trix-content' %>
  </div>

  <div>
    <%= form.label :price, t('products.form.price'), class: 'block font-medium text-gray-700 mb-1' %>
    <%= form.text_field :price, class: 'block w-full border border-gray-300 rounded px-3 py-2', id: 'product_price', autocomplete: 'off', required: true %>
  </div>

  <div>
    <%= form.submit t('products.form.submit'), class: 'px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition' %>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Money mask for price field (BRL format)
  var priceInput = document.getElementById('product_price');
  if (priceInput) {
    priceInput.addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      value = (parseInt(value, 10) / 100).toFixed(2);
      e.target.value = value.replace('.', ',');
    });
  }
});
</script>
